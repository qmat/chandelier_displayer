<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

    <head>
        <!--<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/all.css" />-->

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        
        <style type="text/css">
		  body {
		    margin: 0;
		    padding: 0;
		  }
		  div#visible_wrapper {
		  	width: 2048px;
		  }
		  img {
  		  	margin: 0;
		  	padding: 0;
		  	float: left;
		  }
		  div#hidden_wrapper {
		  	visibility: hidden;
		  }
		</style>
		
		<script type="text/javascript">
		
		
			var startPanoid;
			var previousPanoid;
			var currentPanoid;
			var newPanoid;
			var imagesLoaded;
			var totalImages = 8;
			
			var newImages;
			
		
			function start()
			{
				newImages = [];
				
				for(i=0;i<2;i++)
				{
					newImages[i] = [];
					for(j=0;j<4;j++)
						newImages[i][j] = 0;
				}	
			
				startPanoid = "pRDNtqjbN_gA-828AOQOlw";
				previousPanoid = startPanoid;
				currentPanoid = startPanoid;
				newPanoid = startPanoid;
				// just to be safe set imagesLoaded to 
				imagesLoaded = 0;
				cachePanoid(startPanoid);
			}
			
			
			function cacheImage(url, x, y)
			{
				var img = new Image();
      			newImages[y][x] = img;
      			$(img).load(checkImages).error(checkImages).attr('src', url);
			}
			
			
			function getNextPanoid(panoid)
			{
				var url = 'http://maps.google.com/cbk?callback=?&output=json&panoid='+panoid;
				$.getJSON(url, function(data) {
					
					// if there are no links, shouldn't happen, but hey, it could, then start over.
					if(data['Links'].length <=1)
						start();
					
					// keep track of history
					previousPanoid = currentPanoid;
					currentPanoid = panoid;

					while(true)
					{				
						var randomIndex = Math.floor(Math.random() * data['Links'].length);
						if(data['Links'][randomIndex]["panoId"] != previousPanoid)
						{
							newPanoid = data['Links'][randomIndex]["panoId"];
							//console.debug(newPanoid);
							cachePanoid(newPanoid);
							break;
						}
					}
				})
			}
			
			
			function checkImages()
			{
				imagesLoaded += 1;
				if(imagesLoaded == totalImages)
				{
					displayImages();
					imagesLoaded = 0;
				}
			}
			
			
			function cachePanoid(panoid)
			{
				for(i=0;i<2;i++)
				{
					for(j=0;j<4;j++)
					{
						url = 'http://cbk0.google.com/cbk?output=tile&panoid=' + panoid + '&x=' + j + '&y=' + i + '&zoom=2';
						cacheImage(url, j, i);
					}
				}
			}
			
			
			function displayImages()
			{
				// clear visible wrapper
				$(".wrapper_0").empty();
				$(".wrapper_1").empty();
				
				// add invisible images to visible wrapper
				for(i=0; i<2; i++)
				{
					for(j=0; j<4; j++)
					{
						$("#visible_wrapper .wrapper_"+i).append(newImages[i][j]);
					}
				}
				
				// get next panoid
				setTimeout(function() {getNextPanoid(newPanoid)}, 500);
			}
			
			
		
		</script>
    </head>

    <body onload="start();">

		<div id="visible_wrapper">
		
			<div class="wrapper_0">
			</div>
		
			<br>
		
			<div class="wrapper_1">
			</div>
			
		</div>

    </body>

</html>
